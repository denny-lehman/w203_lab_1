---
title: Q2
author: "Team03: Savita Chari, Denny Lehman, Tymon Silva "
output:
html_document:
df_print: paged
word_document: default
pdf_document: default
editor_options: 
chunk_output_type: inline
---

```{r load packages, echo=FALSE, warning=FALSE, message=FALSE}
library(plyr)
library(dplyr)
library(ggplot2) 
library(knitr)
library(tidyverse) 
library(haven)
```

# Research Question: Did Democratic voters or Republican voters experience more difficulty voting in the 2020 election?


```{r DATA Read , echo=FALSE, warning=TRUE, message=TRUE}
setwd("C:\\Users\\savit\\lab_1\\datasets")
anes_2020_full_data <- read_dta("anes_timeseries_2020_stata_20210719.dta")
# Load and clean dataset
# Get Subset of data of only the columns needed to answer the research question
```

```{r}
summary(anes_2020_full_data$V202120c == 1)
```
```{r DATA WRANGLING , echo=FALSE, warning=TRUE, message=TRUE}
anes_2020_subset <- anes_2020_full_data %>%
  select(Case_Id = V200001, 
         Political_Party_Reg_code = V202064, 
         Pre_Summary_PartyId = V201231x,
         Absentee_Ballot_Problem = V202120c,
         Ballot_Confusion = V202120d,
          Long_Wait = V202120f,
         Polling_Place_Issue = V202120e,
         Pre_Who_DoU_Intend_To_Select = V201033, # Usefull
         Post_Party_Reg = V202064,
         Pre_Party_Reg = V201018, # 1
         Pre_Party_Identification = V201230,
         Pre_Prefer_Presedent = V201036,
         Did_Vote = V202066,  
         President_Voted_For_code = V202073, 
         Voting_Level_Difficulty_Code = V202119, 
         Language_Difficulty = V201658p,
         Difficulty_With_English = V202114i
         )%>%
    filter(Did_Vote == 4)
#  filter(Did_Vote == 4 &  (President_Voted_For_code %in% c(1,2) | Political_Party_Reg_code %in% c(1,2)   ))
# Add a new field called 'Problems' and default it to zero. This field will be increased every time a survey respondent faces an issue during election process
anes_2020_subset$Problems = 0
anes_2020_subset
```
```{r Examine if there is a relationship between various problems faced by a voter, echo=FALSE, warning=TRUE, message=TRUE}
anes_2020_subset_problems <- anes_2020_subset  %>% 
  select(Case_Id, 
         Absentee_Ballot_Problem, 
         Ballot_Confusion, 
         Long_Wait, 
         Polling_Place_Issue, 
         Language_Difficulty,
         Difficulty_With_English,
         Voting_Level_Difficulty_Code
  )
anes_2020_subset_problems

```





```{r DATA WRANGLING - Problems Faced , echo=FALSE, warning=TRUE, message=TRUE}
# In this section we explore the data set for any problem faced by a citizen during the election process.
# The problems could be issues related to:
#   - Absentee allot
#   - Confusion with ballot and/or machines
#   - Long lines
#   - Problem at polling station
#   - Language related issues
# 
# Every time the voter faces one of these problem we add 1 to the 'Problems' field. 
# This is due to the fact that each of these problems are independent of the other and a voter may face more than 1 issue.
#
#
# If Absentee Ballot issues were faced, add 1 to Problem column
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Absentee_Ballot_Problem == 1, anes_2020_subset$Problems+1, anes_2020_subset$Problems))


# If Ballot Confusion issues were faced, add 1 to Problem column
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Ballot_Confusion == 1, anes_2020_subset$Problems+1, anes_2020_subset$Problems))


# If Long Wait to vote issues were faced, add 1 to Problem column
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Long_Wait == 1, anes_2020_subset$Problems+1, anes_2020_subset$Problems))


# If Polling Place related issues were faced, add 1 to Problem column
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Polling_Place_Issue == 1, anes_2020_subset$Problems+1, anes_2020_subset$Problems))

# If Language Related issues were faced, add 1 to Problem column
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Language_Difficulty == 1, anes_2020_subset$Problems+1, anes_2020_subset$Problems))

# If English Language Related issues were faced, add 1 to Problem column
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Difficulty_With_English == 1, anes_2020_subset$Problems+1, anes_2020_subset$Problems))

# There is another field that does not mention the cause of the problem but gives a grade based on general difficulty faced
# We are adding the grade as is to the problems column
# How difficult was it for you to vote in this election, add weighted point(s) to Problem column
# In the previous section, we already established that there is no relationship between 
# the Voting_Level_Difficulty_Code field and the other fields that pinpoint the issue mentioned above.
#
anes_2020_subset$Problems <- with(
  anes_2020_subset, ifelse(anes_2020_subset$Voting_Level_Difficulty_Code > 1, anes_2020_subset$Problems + anes_2020_subset$Voting_Level_Difficulty_Code, anes_2020_subset$Problems))


anes_2020_subset



#count(anes_2020_subset, "Did_Vote")

#summary(anes_2020_subset$Problems>2)
```

# refer https://stackoverflow.com/questions/34998819/r-code-how-to-generate-variable-based-on-multiple-conditions-from-other-variabl
```{r Cleanup , echo=FALSE, warning=TRUE, message=TRUE}


anes_2020_subset
```


```{r Cleanup , echo=FALSE, warning=TRUE, message=TRUE}

# Add detailed and meaningful description for numeric key values. 
# Example: 
# In field V202064(Political_Party_Registration) =>
#           1. Democratic party
#           2. Republican party
#           4. None or ‘independent’

anes_2020_subset_detail <- anes_2020_subset %>% 
  mutate(
    Problems_faced = Problems ,
    Political_Party_Registration = case_when(
      Political_Party_Reg_code == 1 ~ 'Democratic', 
      Political_Party_Reg_code == 2 ~ 'Republican',
      Political_Party_Reg_code == 4 ~ 'Independent'),
    Pre_Summary_PartyLeaning = case_when(
      Pre_Summary_PartyId == 1 ~ 'Democratic', 
      Pre_Summary_PartyId == 2 ~ 'Democratic', 
      Pre_Summary_PartyId == 3 ~ 'Democratic', 
      Pre_Summary_PartyId == 5 ~ 'Republican', 
      Pre_Summary_PartyId == 6 ~ 'Republican', 
      Pre_Summary_PartyId == 7 ~ 'Republican', 
      Pre_Summary_PartyId == 4 ~ 'Independent'),
    Voting_Level_Difficulty = case_when(
      Voting_Level_Difficulty_Code == -9 ~ 'Refused', 
      Voting_Level_Difficulty_Code == -7 ~ 'No post-election data, deleted due to incomplete interview',
      Voting_Level_Difficulty_Code == -6 ~ 'No post-election interview', 
      Voting_Level_Difficulty_Code == -5 ~ 'Interview breakoff (sufficient partial IW)', 
      Voting_Level_Difficulty_Code == -1 ~ 'Inapplicable', 
      Voting_Level_Difficulty_Code ==  1 ~ '1 - Not difficult at all', 
      Voting_Level_Difficulty_Code ==  2 ~ '2 - A little difficult', 
      Voting_Level_Difficulty_Code ==  3 ~ '3 - Moderately difficult', 
      Voting_Level_Difficulty_Code ==  4 ~ '4 - Very difficult', 
      Voting_Level_Difficulty_Code ==  5 ~ '5 - Extremely difficult'),
    President_Voted_For= case_when(
      President_Voted_For_code == 1 ~ 'Biden', 
      President_Voted_For_code == 2 ~ 'Trump'),
    Presidentwise_Party_Identification = case_when(
      President_Voted_For_code == 1 ~ 'Democratic', 
      President_Voted_For_code == 2 ~ 'Republican'),
    Codewise_Party_Identification = case_when(
      Pre_Party_Identification == 1 ~ 'Republican', 
      Pre_Party_Identification == 3 ~ 'Democratic'),
    Partywise_Identification = case_when(
      Pre_Party_Identification == 1 ~ 'Republican', 
      Pre_Party_Identification == 3 ~ 'Democratic',
      Political_Party_Reg_code == 1 ~ 'Democratic', 
      Political_Party_Reg_code == 2 ~ 'Republican',
      Pre_Party_Reg == 1 ~ 'Democratic', 
      Pre_Party_Reg == 2 ~ 'Republican',
      TRUE~"Other")
  )
```

```{r Data Cleanup:filter out Nonrelevant data, echo=FALSE, warning=TRUE, message=TRUE}

anes_2020_subset_clean <- anes_2020_subset_detail %>% 
  select(Case_Id, 
         Did_Vote, 
         Pre_Summary_PartyLeaning,
         Problems_faced,
         President_Voted_For,
         Political_Party_Registration, 
         Voting_Level_Difficulty_Code, 
         Voting_Level_Difficulty,          
         Presidentwise_Party_Identification, 
         Pre_Party_Identification, 
         Codewise_Party_Identification, 
         Partywise_Identification, Pre_Party_Reg)


```

```{r}
anes_2020_subset_clean

```
```{r}


aggregate(anes_2020_subset_clean$Problems_faced, by=list(Party=anes_2020_subset_clean$Pre_Summary_PartyLeaning), FUN=sum)

```
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
